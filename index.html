<script>
    // Base de dados dos brech√≥s (AGORA INCLUI OUTRAS CIDADES)
    const brechosData = [
        // BRECH√ìS EM CARAPICU√çBA
        {
            id: 1,
            nome: "Brech√≥ da Vila",
            endereco: "Rua Jo√£o Batista, 456 - Centro, Carapicu√≠ba - SP",
            cidade: "Carapicu√≠ba", // NOVO CAMPO ADICIONADO PARA FACILITAR A BUSCA
            bairro: "Centro",
            latitude: -23.5225,
            longitude: -46.8356,
            telefone: "(11) 4164-5678",
            whatsapp: "5511941645678",
            site: "https://brechodavila.com.br",
            horarios: "Seg-Sex: 9h-18h | S√°b: 9h-14h",
            estrelas: 4.5,
            avaliacoes: 127,
            doacoes: "Aceita doa√ß√µes como troca",
            precoMin: 10,
            precoMax: 150,
            tiposPecas: "Usadas e novas",
            caracteristicas: ["doa√ß√µes", "troca", "roupa feminina", "roupa masculina"]
        },
        {
            id: 2,
            nome: "Recicla Moda",
            endereco: "Av. Presidente Vargas, 890 - Vila Caldas, Carapicu√≠ba - SP",
            cidade: "Carapicu√≠ba",
            bairro: "Vila Caldas",
            latitude: -23.5285,
            longitude: -46.8425,
            telefone: "(11) 4163-2345",
            whatsapp: "5511941632345",
            site: "https://reciclamoda.com.br",
            horarios: "Seg-S√°b: 10h-19h",
            estrelas: 4.8,
            avaliacoes: 203,
            doacoes: "Recebe doa√ß√µes sem troca",
            precoMin: 15,
            precoMax: 200,
            tiposPecas: "Usadas e novas",
            caracteristicas: ["doa√ß√µes", "roupa feminina", "acess√≥rios", "bolsas"]
        },
        {
            id: 3,
            nome: "Brech√≥ Solid√°rio Esperan√ßa",
            endereco: "Rua Maria Am√©lia, 123 - Cohab V, Carapicu√≠ba - SP",
            cidade: "Carapicu√≠ba",
            bairro: "Cohab V",
            latitude: -23.5195,
            longitude: -46.8298,
            telefone: "(11) 4165-8901",
            whatsapp: "5511941658901",
            site: null,
            horarios: "Ter-S√°b: 8h-17h",
            estrelas: 4.3,
            avaliacoes: 89,
            doacoes: "Aceita doa√ß√µes como troca",
            precoMin: 5,
            precoMax: 80,
            tiposPecas: "Apenas usadas",
            caracteristicas: ["doa√ß√µes", "troca", "pre√ßo baixo", "solid√°rio"]
        },
        {
            id: 4,
            nome: "Chic Brech√≥",
            endereco: "Rua das Palmeiras, 234 - Parque Santa Teresa, Carapicu√≠ba - SP",
            cidade: "Carapicu√≠ba",
            bairro: "Parque Santa Teresa",
            latitude: -23.5310,
            longitude: -46.8380,
            telefone: "(11) 4162-7890",
            whatsapp: "5511941627890",
            site: "https://chicbrecho.com.br",
            horarios: "Seg-Sex: 10h-19h | S√°b: 10h-16h",
            estrelas: 4.7,
            avaliacoes: 156,
            doacoes: "Recebe doa√ß√µes sem troca",
            precoMin: 20,
            precoMax: 300,
            tiposPecas: "Usadas e novas",
            caracteristicas: ["roupa feminina", "roupas de marca", "acess√≥rios", "sapatos"]
        },
        {
            id: 5,
            nome: "Brech√≥ da Tia Lu",
            endereco: "Rua S√£o Jos√©, 567 - Vila Dirce, Carapicu√≠ba - SP",
            cidade: "Carapicu√≠ba",
            bairro: "Vila Dirce",
            latitude: -23.5265,
            longitude: -46.8335,
            telefone: "(11) 4164-3456",
            whatsapp: "5511941643456",
            site: null,
            horarios: "Seg-S√°b: 9h-18h",
            estrelas: 4.6,
            avaliacoes: 134,
            doacoes: "Aceita doa√ß√µes como troca",
            precoMin: 10,
            precoMax: 120,
            tiposPecas: "Usadas e novas",
            caracteristicas: ["doa√ß√µes", "troca", "roupa infantil", "roupa feminina"]
        },
        {
            id: 6,
            nome: "Sustenta Fashion",
            endereco: "Av. Inoc√™ncio Ser√°fico, 789 - Centro, Carapicu√≠ba - SP",
            cidade: "Carapicu√≠ba",
            bairro: "Centro",
            latitude: -23.5240,
            longitude: -46.8365,
            telefone: "(11) 4163-4567",
            whatsapp: "5511941634567",
            site: "https://sustentafashion.com.br",
            horarios: "Ter-Sex: 10h-18h | S√°b: 9h-15h",
            estrelas: 4.4,
            avaliacoes: 98,
            doacoes: "Recebe doa√ß√µes sem troca",
            precoMin: 15,
            precoMax: 180,
            tiposPecas: "Usadas e novas",
            caracteristicas: ["sustent√°vel", "roupa feminina", "roupa masculina", "acess√≥rios"]
        },
        {
            id: 7,
            nome: "Brech√≥ da Pra√ßa",
            endereco: "Pra√ßa da Liberdade, 88 - Jardim Ana Estela, Carapicu√≠ba - SP",
            cidade: "Carapicu√≠ba",
            bairro: "Jardim Ana Estela",
            latitude: -23.5275,
            longitude: -46.8395,
            telefone: "(11) 4184-2468",
            whatsapp: "5511941842468",
            site: null,
            horarios: "Ter-S√°b: 10h-18h",
            estrelas: 4.1,
            avaliacoes: 67,
            precoMin: 10,
            precoMax: 60,
            doacoes: "N√£o aceita doa√ß√µes ou troca",
            tiposPecas: "Apenas usadas",
            caracteristicas: ["usadas", "pre√ßo justo"]
        },
        {
            id: 8,
            nome: "Brech√≥ Estilo √önico",
            endereco: "Rua S√£o Jo√£o, 789 - Jardim Veloso, Carapicu√≠ba - SP",
            cidade: "Carapicu√≠ba",
            bairro: "Jardim Veloso",
            latitude: -23.5305,
            longitude: -46.8286,
            telefone: "(11) 4184-9012",
            whatsapp: "5511941849012",
            site: "https://estilounico.com.br",
            horarios: "Ter-Dom: 10h-20h",
            estrelas: 4.3,
            avaliacoes: 89,
            precoMin: 20,
            precoMax: 150,
            doacoes: "Aceita troca, n√£o aceita doa√ß√µes",
            tiposPecas: "Usadas e novas",
            caracteristicas: ["troca", "usadas", "novas", "pe√ßas de marca"]
        },
        // NOVOS BRECH√ìS EM OUTRAS CIDADES
        {
            id: 9,
            nome: "Garimpo Osasco",
            endereco: "Rua Ant√¥nio Agu, 300 - Centro, Osasco - SP",
            cidade: "Osasco", // NOVO BRECH√ì EM OSASCO
            bairro: "Centro",
            latitude: -23.5320,
            longitude: -46.7905,
            telefone: "(11) 3682-1234",
            whatsapp: "5511936821234",
            site: null,
            horarios: "Seg-S√°b: 9h-19h",
            estrelas: 4.6,
            avaliacoes: 310,
            doacoes: "Aceita doa√ß√µes sem troca",
            precoMin: 15,
            precoMax: 100,
            tiposPecas: "Usadas em bom estado",
            caracteristicas: ["doa√ß√µes", "pre√ßo baixo", "roupa masculina"]
        },
        {
            id: 10,
            nome: "Alpha Brech√≥ Premium",
            endereco: "Cal√ßada das Margaridas, 100 - Alphaville, Barueri - SP",
            cidade: "Barueri", // NOVO BRECH√ì EM BARUERI
            bairro: "Alphaville",
            latitude: -23.5042,
            longitude: -46.8529,
            telefone: "(11) 4195-5678",
            whatsapp: "5511941955678",
            site: "https://alphabrecho.com",
            horarios: "Ter-Dom: 11h-20h",
            estrelas: 4.9,
            avaliacoes: 250,
            doacoes: "Apenas consigna√ß√£o de marca",
            precoMin: 50,
            precoMax: 500,
            tiposPecas: "Novas e seminovas de grife",
            caracteristicas: ["grife", "luxo", "semi-nova", "acess√≥rios"]
        },
    ];

    // Inicializar o mapa
    // Centralizando em Carapicu√≠ba por padr√£o
    const map = L.map('map').setView([-23.5225, -46.8356], 13);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap contributors',
        maxZoom: 19
    }).addTo(map);

    let markers = {};

    // Fun√ß√£o para criar √≠cone personalizado
    function createCustomIcon() {
        return L.divIcon({
            className: 'custom-marker',
            html: '<div style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); width: 30px; height: 30px; border-radius: 50% 50% 50% 0; border: 3px solid white; box-shadow: 0 3px 10px rgba(0,0,0,0.3); transform: rotate(-45deg);"><div style="transform: rotate(45deg); color: white; font-size: 18px; text-align: center; line-height: 24px;">üõçÔ∏è</div></div>',
            iconSize: [36, 36],
            iconAnchor: [18, 36],
            popupAnchor: [0, -36]
        });
    }

    // Fun√ß√£o para criar conte√∫do do popup
    function createPopupContent(brecho) {
        const stars = '‚≠ê'.repeat(Math.floor(brecho.estrelas));
        return `
            <div class="popup-content">
                <div class="popup-title">${brecho.nome}</div>
                <div style="color: #f39c12; margin-bottom: 10px;">${stars} ${brecho.estrelas} (${brecho.avaliacoes} avalia√ß√µes)</div>
                <div style="margin: 5px 0;"><strong>üìç</strong> ${brecho.endereco}</div>
                <div style="margin: 5px 0;"><strong>üìû</strong> ${brecho.telefone}</div>
                <div style="margin: 5px 0;"><strong>üïê</strong> ${brecho.horarios}</div>
                <div style="margin: 5px 0;"><strong>üí∞</strong> R$${brecho.precoMin} - R$${brecho.precoMax}</div>
                <div style="margin: 5px 0;"><strong>üëï</strong> ${brecho.tiposPecas}</div>
                <div style="margin: 5px 0;"><strong>üéÅ</strong> ${brecho.doacoes}</div>
            </div>
        `;
    }

    // Fun√ß√£o para adicionar marcadores
    function addMarkers(brechos) {
        // Limpar marcadores anteriores
        Object.values(markers).forEach(marker => map.removeLayer(marker));
        markers = {};

        brechos.forEach(brecho => {
            const marker = L.marker([brecho.latitude, brecho.longitude], {
                icon: createCustomIcon()
            }).addTo(map);
            
            marker.bindPopup(createPopupContent(brecho));
            markers[brecho.id] = marker;
        });

        if (brechos.length > 0) {
            // Ajustar o mapa para mostrar todos os resultados
            const bounds = L.latLngBounds(brechos.map(b => [b.latitude, b.longitude]));
            map.fitBounds(bounds, { padding: [50, 50] });
        } else {
             // Se n√£o houver resultados, recentraliza em Carapicu√≠ba
             map.setView([-23.5225, -46.8356], 13);
        }
    }

    // Fun√ß√£o para criar card
    function createCard(brecho) {
        const stars = '‚≠ê'.repeat(Math.floor(brecho.estrelas));
        const whatsappLink = `https://wa.me/${brecho.whatsapp}`;
        const websiteBtn = brecho.site ? 
            `<a href="${brecho.site}" target="_blank" class="contact-btn website-btn">üåê Site</a>` : '';
        
        return `
            <div class="brecho-card visible" data-id="${brecho.id}">
                <div class="card-header">
                    <div class="card-title">${brecho.nome}</div>
                    <div class="rating">${stars} ${brecho.estrelas}</div>
                </div>
                
                <div class="card-info">
                    <div class="card-info-item">
                        <span class="icon">üìç</span>
                        <span>${brecho.endereco}</span>
                    </div>
                    <div class="card-info-item">
                        <span class="icon">üìû</span>
                        <span>${brecho.telefone}</span>
                    </div>
                    <div class="card-info-item">
                        <span class="icon">üïê</span>
                        <span>${brecho.horarios}</span>
                    </div>
                    <div class="card-info-item">
                        <span class="icon">üí¨</span>
                        <span>${brecho.avaliacoes} avalia√ß√µes</span>
                    </div>
                </div>
                
                <div class="price-range">
                    üí∞ Faixa de pre√ßo: R$${brecho.precoMin} - R$${brecho.precoMax}
                </div>
                
                <div>
                    <span class="badge">üëï ${brecho.tiposPecas}</span>
                    <span class="badge">üéÅ ${brecho.doacoes}</span>
                </div>
                
                <div class="contact-btns">
                    <a href="${whatsappLink}" target="_blank" class="contact-btn whatsapp-btn">üí¨ WhatsApp</a>
                    ${websiteBtn}
                </div>
            </div>
        `;
    }

    // Fun√ß√£o de busca (L√ìGICA EXPANDIDA PARA INCLUIR CIDADE)
    function searchBrechos() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
        
        if (!searchTerm) {
            document.getElementById('resultsHeader').textContent = 'Digite algo na busca para ver os brech√≥s';
            document.getElementById('cardsContainer').innerHTML = '<div class="no-results">Use a busca acima para encontrar brech√≥s</div>';
            Object.values(markers).forEach(marker => map.removeLayer(marker));
            map.setView([-23.5225, -46.8356], 13); 
            return;
        }
        
        const results = brechosData.filter(brecho => {
            // Verifica se o termo de busca est√° no nome, bairro, endere√ßo, caracter√≠sticas, doa√ß√µes, OU na CIDADE.
            return brecho.nome.toLowerCase().includes(searchTerm) ||
                    brecho.bairro.toLowerCase().includes(searchTerm) ||
                    (brecho.cidade && brecho.cidade.toLowerCase().includes(searchTerm)) || // NOVA VERIFICA√á√ÉO DE CIDADE
                    brecho.endereco.toLowerCase().includes(searchTerm) ||
                    (brecho.caracteristicas && brecho.caracteristicas.some(c => c.toLowerCase().includes(searchTerm))) ||
                    (brecho.doacoes && brecho.doacoes.toLowerCase().includes(searchTerm));
        });
        
        if (results.length === 0) {
            document.getElementById('resultsHeader').textContent = 'Nenhum brech√≥ encontrado';
            document.getElementById('cardsContainer').innerHTML = '<div class="no-results">N√£o encontramos brech√≥s com esse crit√©rio. Tente buscar por: nome, bairro, **cidade** ("Osasco", "Barueri", etc.), "doa√ß√µes" ou "troca"</div>';
            Object.values(markers).forEach(marker => map.removeLayer(marker));
            map.setView([-23.5225, -46.8356], 13);
            return;
        }
        
        document.getElementById('resultsHeader').textContent = `${results.length} brech√≥(s) encontrado(s)`;
        
        const cardsHTML = results.map(brecho => createCard(brecho)).join('');
        document.getElementById('cardsContainer').innerHTML = cardsHTML;
        
        addMarkers(results);
    }

    // Busca ao pressionar Enter
    document.getElementById('searchInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            searchBrechos();
        }
    });

    console.log('Mapa carregado! Use a busca para encontrar brech√≥s.');
</script>




